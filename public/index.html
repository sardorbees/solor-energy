<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="../src/components/assets/img/logo/–õ–æ–≥–æ.png" />
  <meta name="csrf-token" content="{{ csrf_token }}">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Web site created using create-react-app" />
  <link rel="apple-touch-icon" href="../src/components/assets/img/logo/–õ–æ–≥–æ.png" />
  <link rel="manifest" href="../src/components/assets/img/logo/–õ–æ–≥–æ.png" />
  <title>Enerji Project</title>
</head>

<body>
  <noscript>–î–æ–±—Ä–æ –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å Enerji Project!</noscript>
  <div id="root"></div>
  <script>
    const form = document.getElementById("contactForm");
    const messageBox = document.getElementById("statusMessage");
    const submitBtn = document.getElementById("submitBtn");
    const retryBtn = document.getElementById("retryBtn");

    let blockUntil = localStorage.getItem("block_until");

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (blockUntil && Date.now() < parseInt(blockUntil)) {
      startCountdown(parseInt(blockUntil));
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      messageBox.textContent = "";

      if (Date.now() < parseInt(localStorage.getItem("block_until") || 0)) {
        return;
      }

      submitBtn.disabled = true;

      const formData = new FormData(form);
      const jsonData = Object.fromEntries(formData.entries());

      try {
        const res = await fetch("http://127.0.0.1:8000/api/applicationapplications/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(jsonData),
        });

        const data = await res.json();

        if (res.ok) {
          messageBox.textContent = "‚úÖ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!";
          form.reset();
          const oneHourLater = Date.now() + 60 * 60 * 1000;
          localStorage.setItem("block_until", oneHourLater);
          startCountdown(oneHourLater);
        } else if (res.status === 429) {
          const detail = data.detail || "–í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –∑–∞—è–≤–∫—É. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —á–µ—Ä–µ–∑ 1 —á–∞—Å.";
          messageBox.textContent = "‚ùå " + detail;

          const match = detail.match(/(\d+)/);
          if (match) {
            const minutes = parseInt(match[1], 10);
            const until = Date.now() + minutes * 60 * 1000;
            localStorage.setItem("block_until", until);
            startCountdown(until);
          }
        } else {
          messageBox.textContent = "‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã.";
        }
      } catch (err) {
        console.error(err);
        messageBox.textContent = "‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.";
      } finally {
        submitBtn.disabled = false;
      }
    });

    retryBtn.addEventListener("click", async () => {
      // –ü—Ä–æ–≤–µ—Ä–∏–º, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
      const blockUntil = parseInt(localStorage.getItem("block_until") || 0);
      if (Date.now() < blockUntil) {
        messageBox.textContent = "‚è≥ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–∂–¥–∏—Ç–µ—Å—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏.";
        return;
      }

      try {
        const res = await fetch("http://127.0.0.1:8000/api/unlock-ip/");
        const data = await res.json();
        messageBox.textContent = data.detail || "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ.";
        localStorage.removeItem("block_until");
        retryBtn.style.display = "none";
        retryBtn.disabled = true;
        submitBtn.disabled = false;
      } catch (e) {
        messageBox.textContent = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å.";
      }
    });

    function startCountdown(untilTimestamp) {
      retryBtn.style.display = "inline-block";
      retryBtn.disabled = true; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–Ω–æ–ø–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
      submitBtn.disabled = true;

      const interval = setInterval(() => {
        const now = Date.now();
        const diff = untilTimestamp - now;

        if (diff <= 0) {
          clearInterval(interval);
          localStorage.removeItem("block_until");
          messageBox.textContent = "üü¢ –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É.";
          retryBtn.disabled = false; // —Ä–∞–∑—Ä–µ—à–∞–µ–º –Ω–∞–∂–∏–º–∞—Ç—å
          submitBtn.disabled = false;
          return;
        }

        const min = Math.floor(diff / 60000);
        const sec = Math.floor((diff % 60000) / 1000);
        messageBox.textContent = `‚è≥ –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —á–µ—Ä–µ–∑ ${min} –º–∏–Ω ${sec} —Å–µ–∫`;
      }, 1000);
    }
  </script>
  <script>
    function sendForm(token) {
      const formData = {
        full_name: document.querySelector('[name="full_name"]').value,
        phone: document.querySelector('[name="phone"]').value,
        address: document.querySelector('[name="address"]').value,
        description: document.querySelector('[name="description"]').value,
        recaptcha_token: token,
      };

      fetch("http://127.0.0.1:8000/api/applicationapplications/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(formData),
      })
        .then(res => res.json())
        .then(data => {
          alert("–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ");
        })
        .catch(err => {
          alert("–û—à–∏–±–∫–∞");
        });
    }

  </script>
  <script>
    fetch('http://localhost:8000/swagger/')
      .then(res => {
        if (!res.ok) throw new Error("–ó–∞–∫—Ä—ã—Ç–æ");
        return res.text();
      })
      .then(console.log)
      .catch(err => console.error("–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ:", err));
  </script>
  <script>
    // ‚úÖ –ß–∏—Å—Ç—ã–π JavaScript –±–µ–∑ –æ—à–∏–±–æ–∫, API –∏ Swagger
    function showTime() {
      const now = new Date();
      const formatted = now.toLocaleTimeString();
      document.getElementById('output').innerText = "–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: " + formatted;
    }
  </script>
  <!-- <script>
    (function () {
      // –ó–∞–ø—Ä–µ—Ç –∫–ª–∞–≤–∏—à F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
      document.addEventListener('keydown', function (e) {
        if (
          e.key === 'F12' ||
          (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
          (e.ctrlKey && e.key === 'U')
        ) {
          e.preventDefault();
          alert('–û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Å–æ–ª–∏ –∑–∞–ø—Ä–µ—â–µ–Ω–æ');
          return false;
        }
      });

      // –ó–∞–ø—Ä–µ—Ç –ø—Ä–∞–≤–æ–≥–æ –∫–ª–∏–∫–∞
      document.addEventListener('contextmenu', function (e) {
        e.preventDefault();
        alert('–ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –∑–∞–ø—Ä–µ—â—ë–Ω');
      });

      // –ü–æ–ø—ã—Ç–∫–∞ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ DevTools
      var devtools = { open: false };
      var threshold = 160;

      setInterval(function () {
        var widthThreshold = window.outerWidth - window.innerWidth > threshold;
        var heightThreshold = window.outerHeight - window.innerHeight > threshold;
        if (widthThreshold || heightThreshold) {
          if (!devtools.open) {
            devtools.open = true;
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞!');
            // –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            // window.location.href = 'about:blank';
            // window.close();
          }
        } else {
          devtools.open = false;
        }
      }, 1000);

    })();
  </script> -->
  <!-- <script>
    document.addEventListener('contextmenu', event => event.preventDefault());
    document.addEventListener('keydown', event => {
      if (event.key === "F12" || (event.ctrlKey && event.shiftKey && event.key === "I")) {
        event.preventDefault();
      }
    });
    function greet(name) {
      console.log("Hello, " + name + "!");
    }
    setInterval(() => {
      if (window.outerWidth - window.innerWidth > 100 || window.outerHeight - window.innerHeight > 100) {
        window.close(); // –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
      }
    }, 1000);
    greet("User");
    var _0x1a2b = ["\x48\x65\x6C\x6C\x6F\x2C\x20", "\x21"]; function greet(_0x1a3b) { console["\x6C\x6F\x67"](_0x1a2b[0] + _0x1a3b + _0x1a2b[1]) } greet("\x55\x73\x65\x72");
  </script> -->
</body>

</html>